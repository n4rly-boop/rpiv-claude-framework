---
name: tooling
description: Run project code quality tools (check, test, format). Auto-detects project type or uses project-specific configuration. Use when validating code, running tests, or formatting before commits.
---

# Tooling Skill

Run project code quality tools with automatic project type detection.

## Usage

```
/tooling check    # Run linting, type checking, static analysis
/tooling test     # Run test suite
/tooling format   # Format code (auto-fix style issues)
```

## How It Works

1. **Check for project-specific config** - If this project has a customized tooling skill (generated by `/extract_conventions`), use those exact commands
2. **Auto-detect project type** - Otherwise, detect based on config files and run appropriate commands
3. **Report results** - Capture full output, report status with exit code

## Auto-Detection Logic

### Check Command

Detection order (first match wins):

| File Present | Check For | Command |
|--------------|-----------|---------|
| `Makefile` | `check` target | `make check` |
| `package.json` | `lint` script | `npm run lint` |
| `package.json` | `check` script | `npm run check` |
| `pyproject.toml` | ruff in deps | `ruff check .` |
| `pyproject.toml` | flake8 in deps | `flake8` |
| `setup.py` or `requirements.txt` | - | `flake8` (if installed) |
| `Cargo.toml` | - | `cargo clippy` |
| `go.mod` | - | `go vet ./...` |
| `.eslintrc*` | - | `npx eslint .` |
| `tsconfig.json` | - | `npx tsc --noEmit` |
| None detected | - | Skip with note |

**For Python projects**, also check for type checkers:
- If `mypy` in dependencies → append `mypy .`
- If `pyright` in dependencies → append `pyright`

### Test Command

| File Present | Check For | Command |
|--------------|-----------|---------|
| `Makefile` | `test` target | `make test` |
| `package.json` | `test` script | `npm test` |
| `pyproject.toml` | pytest in deps | `pytest` |
| `setup.py` | - | `pytest` (if installed) |
| `Cargo.toml` | - | `cargo test` |
| `go.mod` | - | `go test ./...` |
| `mix.exs` | - | `mix test` |
| `Gemfile` | - | `bundle exec rspec` or `rake test` |
| None detected | - | Skip with note |

### Format Command

| File Present | Check For | Command |
|--------------|-----------|---------|
| `Makefile` | `format` target | `make format` |
| `package.json` | `format` script | `npm run format` |
| `pyproject.toml` | black in deps | `black .` |
| `pyproject.toml` | ruff in deps | `ruff format .` |
| `.prettierrc*` | - | `npx prettier --write .` |
| `Cargo.toml` | - | `cargo fmt` |
| `go.mod` | - | `go fmt ./...` |
| `mix.exs` | - | `mix format` |
| None detected | - | Skip with note |

## Execution Instructions

### For `/tooling check`:

1. **Detect project type**:
   ```bash
   # Check what config files exist
   ls -la Makefile package.json pyproject.toml Cargo.toml go.mod 2>/dev/null
   ```

2. **If Makefile exists, check for target**:
   ```bash
   make -n check 2>/dev/null && echo "check target exists"
   ```

3. **Run detected command(s)**, capturing full output:
   ```bash
   <detected_command> 2>&1
   ```

4. **Report results** in standard format (see Output Format below)

### For `/tooling test`:

1. **Detect project type** (same as check)

2. **If Makefile exists, check for target**:
   ```bash
   make -n test 2>/dev/null && echo "test target exists"
   ```

3. **Run detected command**, capturing full output including test counts

4. **Report results** with pass/fail summary

### For `/tooling format`:

1. **Detect project type** (same as check)

2. **Run detected command**

3. **Report files changed**

## Output Format

Always report in this structure:

```markdown
## Tooling: <subcommand>

**Detected**: <project type> (found: <config file>)
**Command**: `<actual command run>`
**Status**: PASS | FAIL | SKIPPED

<output, truncated to max 100 lines if longer>

**Exit code**: <N>
```

### Examples

**Successful check:**
```markdown
## Tooling: check

**Detected**: Python/Poetry (found: pyproject.toml with ruff, mypy)
**Command**: `ruff check . && mypy .`
**Status**: PASS

All checks passed!
- ruff: 0 errors, 0 warnings
- mypy: Success: no issues found in 42 source files

**Exit code**: 0
```

**Failed test:**
```markdown
## Tooling: test

**Detected**: Node.js (found: package.json with test script)
**Command**: `npm test`
**Status**: FAIL

> project@1.0.0 test
> jest

FAIL src/utils.test.js
  ✕ should validate email (5ms)

Tests: 1 failed, 15 passed, 16 total

**Exit code**: 1
```

**Skipped (no tooling found):**
```markdown
## Tooling: check

**Detected**: Unknown project type
**Command**: (none)
**Status**: SKIPPED

No check tooling detected. To configure project-specific tooling:
1. Run `/extract_conventions` to auto-detect and generate config
2. Or manually create `.claude/skills/tooling/SKILL.md`

**Exit code**: 0
```

## Combining Commands

For validation workflows, you can run multiple checks:

```
/tooling format   # First format
/tooling check    # Then verify
/tooling test     # Then test
```

The RPIV `/validate` command runs check and test automatically as part of Pass 1.

## Project-Specific Override

If a project needs custom tooling commands, `/extract_conventions` will generate a project-specific skill that overrides this default.

The generated skill will be placed at:
```
<project>/.claude/skills/tooling/SKILL.md
```

Project-specific skills take precedence over this framework default.

## Fail-All-At-Once Behavior

When running checks, **always capture full output** - never stop on first error:

```bash
# CORRECT - captures everything
ruff check . 2>&1 || true
mypy . 2>&1 || true
# Then report all issues together

# WRONG - stops on first failure
ruff check . && mypy .
```

This ensures you see ALL issues in one run, not iteratively.

## Common Project Configurations

### Python (Poetry)
```
Detected: pyproject.toml
Check: poetry run ruff check . && poetry run mypy .
Test: poetry run pytest
Format: poetry run black . && poetry run ruff format .
```

### Python (pip/venv)
```
Detected: requirements.txt or setup.py
Check: ruff check . && mypy .
Test: pytest
Format: black .
```

### Node.js (npm)
```
Detected: package.json
Check: npm run lint (or npm run check)
Test: npm test
Format: npm run format (or npx prettier --write .)
```

### Rust
```
Detected: Cargo.toml
Check: cargo clippy
Test: cargo test
Format: cargo fmt
```

### Go
```
Detected: go.mod
Check: go vet ./...
Test: go test ./...
Format: go fmt ./...
```

## Troubleshooting

**"Command not found"**:
- Ensure tools are installed in the project
- For Python, check if you need `poetry run` or `pipenv run` prefix
- For Node, check if command is in devDependencies

**"No tooling detected"**:
- Run `/extract_conventions` to set up project-specific config
- Or add a Makefile with `check`, `test`, `format` targets

**"Wrong command detected"**:
- Create project-specific tooling skill via `/extract_conventions`
- This overrides auto-detection with your exact commands
